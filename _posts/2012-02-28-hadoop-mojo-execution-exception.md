--- 
title: Hadoop 'mojo execution exception'
type: post
layout: post
tags: 
- Hadoop
- Maven
---
为了和apache的git repo保持同步，今天git pull hadoop0.23代码，发现已经是0.23.3的版本了。<br /><br />和往常一样，先编译。<br /><br />在mvn package时总是卡在Apache Hadoop HttpFS模块，提示如下：<br /><span style="background-color: #cccccc; color: #274e13;">[INFO] Apache Hadoop HDFS ................................ SUCCESS [29.722s]</span><br /><span style="background-color: #cccccc;"><span style="color: #274e13;">[INFO] Apache Hadoop HttpFS .............................. FAILURE [2.307s]</span></span><br /><span style="background-color: #cccccc;"><span style="color: #274e13;">[INFO] Apache Hadoop HDFS Project ........................ SKIPPED</span></span><br /><span style="background-color: #cccccc;"><span style="color: #274e13;">......</span></span><br /><span style="background-color: #cccccc;"><span style="color: #274e13;">[ERROR] Failed to execute goal org.apache.maven.plugins:maven-antrun-plugin:1.6:run (dist) on project hadoop-hdfs-httpfs: An Ant BuildException has occured: exec returned: 2 -> [Help 1]</span></span><br /><br /><span style="background-color: #cccccc;"><span style="color: #274e13;">[ERROR] For more information about the errors and possible solutions, please read the following articles:</span></span><br /><span style="background-color: #cccccc;"><span style="color: #274e13;">[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException</span></span><br /><span style="background-color: #cccccc;"><span style="color: #274e13;">[ERROR] </span></span><br /><span style="background-color: #cccccc;"><span style="color: #274e13;">[ERROR] After correcting the problems, you can resume the build with the command</span></span><br /><span style="background-color: #cccccc;"><span style="color: #274e13;">[ERROR]   mvn <goals> -rf :hadoop-hdfs-httpfs</span></span><br /><span style="background-color: #cccccc;"><span style="color: #274e13;"><br /></span></span><br /><div></div><div>根据提示到http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException查看，发现这不是maven的问题，应该是其中的某个插件出现了问题。</div><div></div><div>到底是哪个插件呢？</div><div>编译到Apache Hadoop HttpFS出错，那就到Apache Hadoop HttpFS的下面找pom.xml查看。</div><div></div><div>使用mvn -X -e选项重新执行mvn package，看到了提示：</div><div></div><div><div><span style="background-color: #cccccc; color: #274e13;">    [mkdir] Created dir: /home/nourl/github/hadoop-common/hadoop-hdfs-project/hadoop-hdfs-httpfs/target/tomcat.exp</span></div><div><span style="background-color: #cccccc; color: #274e13;">     [exec] Current OS is Linux</span></div><div><span style="background-color: #cccccc; color: #274e13;">     [exec] Executing 'sh' with arguments:</span></div><div><span style="background-color: #cccccc; color: #274e13;">     [exec] './tomcat-untar.sh'</span></div><div><span style="background-color: #cccccc; color: #274e13;">     [exec] </span></div><div><span style="background-color: #cccccc; color: #274e13;">     [exec] The ' characters around the executable and arguments are</span></div><div><span style="background-color: #cccccc; color: #274e13;">     [exec] not part of the command.</span></div><div><span style="background-color: #cccccc; color: #274e13;">Execute:Java13CommandLauncher: Executing 'sh' with arguments:</span></div><div><span style="background-color: #cccccc; color: #274e13;">'./tomcat-untar.sh'</span></div><div><span style="background-color: #cccccc; color: #274e13;"><br /></span></div><div><span style="background-color: #cccccc; color: #274e13;">The ' characters around the executable and arguments are</span></div><div><span style="background-color: #cccccc; color: #274e13;">not part of the command.</span></div><div><span style="background-color: #cccccc; color: #274e13;">     [exec] </span></div><div><span style="background-color: #cccccc; color: #274e13;">     [exec] gzip: stdin: unexpected end of file</span></div><div><span style="background-color: #cccccc; color: #274e13;">     [exec] tar: Unexpected EOF in archive</span></div><div><span style="background-color: #cccccc; color: #274e13;">     [exec] tar: Unexpected EOF in archive</span></div><div><span style="background-color: #cccccc; color: #274e13;">     [exec] tar: Error is not recoverable: exiting now</span></div></div><br /><div></div><div>对应Apache Hadoop HttpFS下的pom.xml，发现原来是下面的代码出现了问题：</div><div><div></div><div><span style="background-color: #cccccc;"><span style="color: #274e13;">                   <mkdir dir="downloads"/></span></span></div><div><span style="background-color: #cccccc;"><span style="color: #274e13;">                    <get</span></span></div><div><span style="background-color: #cccccc;"><span style="color: #274e13;">                        src="http://archive.apache.org/dist/tomcat/tomcat-6/v${tomcat.version}/bin/apache-tomcat-${tomcat.version}.tar.gz"</span></span></div><div><span style="background-color: #cccccc;"><span style="color: #274e13;">                        dest="downloads/tomcat.tar.gz" verbose="true" skipexisting="true"/></span></span></div><div><span style="background-color: #cccccc;"><span style="color: #274e13;">                    <delete dir="${project.build.directory}/tomcat.exp"/></span></span></div><div><span style="background-color: #cccccc;"><span style="color: #274e13;">                    <mkdir dir="${project.build.directory}/tomcat.exp"/></span></span></div><div><span style="background-color: #cccccc; color: #274e13;">                    <!-- Using Unix script to preserve file permissions --></span></div><div><span style="background-color: #cccccc;"><span style="color: #274e13;">                    <echo file="${project.build.directory}/tomcat-untar.sh"></span></span></div><div><span style="background-color: #cccccc; color: #274e13;">                      which cygpath 2> /dev/null</span></div><div><span style="background-color: #cccccc;"><span style="color: #274e13;">                      if [ $? = 1 ]; then</span></span></div><div><span style="background-color: #cccccc;"><span style="color: #274e13;">                      BUILD_DIR="${project.build.directory}"</span></span></div><div><span style="background-color: #cccccc;"><span style="color: #274e13;">                      else</span></span></div><div><span style="background-color: #cccccc;"><span style="color: #274e13;">                      BUILD_DIR=`cygpath --unix '${project.build.directory}'`</span></span></div><div><span style="background-color: #cccccc;"><span style="color: #274e13;">                      fi</span></span></div><div><span style="background-color: #cccccc;"><span style="color: #274e13;">                      cd $BUILD_DIR/tomcat.exp</span></span></div><div><span style="background-color: #cccccc;"><span style="color: #274e13;">                      tar xzf ${basedir}/downloads/tomcat.tar.gz</span></span></div><div><span style="background-color: #cccccc;"><span style="color: #274e13;">                    </echo></span></span><br /><span style="background-color: #cccccc;"><span style="color: #274e13;"><br /></span></span></div></div><div></div><div>找到build.directory下面的tomcat-untar.sh，sh -X执行调试发现，tar解压tomcat.tar.gz提示错误：</div><div><div><span style="background-color: #cccccc;"><span style="color: #274e13;">gzip: stdin: unexpected end of file</span></span></div><div><span style="background-color: #cccccc;"><span style="color: #274e13;">tar: Unexpected EOF in archive</span></span></div><div><span style="background-color: #cccccc;"><span style="color: #274e13;">tar: Unexpected EOF in archive</span></span></div><div><span style="background-color: #cccccc;"><span style="color: #274e13;">tar: Error is not recoverable: exiting now</span></span><br /><span style="background-color: #cccccc;"><span style="color: #274e13;"><br /></span></span></div></div><div></div><div>查看tar.gz文件，只有418K，查看原文件<a href="http://archive.apache.org/dist/tomcat/tomcat-6/v6.0.32/bin/">http://archive.apache.org/dist/tomcat/tomcat-6/v6.0.32/bin/</a>，有6.3M</div><div><div><span style="background-color: #cccccc;"><span style="color: #274e13;">total 420K</span></span></div><div><span style="background-color: #cccccc;"><span style="color: #274e13;">-rw-rw-r-- 1 nourl nourl 418K 2012-02-28 13:33 tomcat.tar.gz</span></span><br /><span style="background-color: #cccccc;"><span style="color: #274e13;"><br /></span></span></div></div><div></div><div>这就是出错的原因了，tomcat没有完整down下来，解压肯定出错。</div><div></div><div>手工down一份放到downloads目录下，重新执行mvn package，OK～！<br /><br /></div><div></div>

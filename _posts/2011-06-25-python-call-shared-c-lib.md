--- 
title: Python call shared C lib
type: post
layout: post
tags: 
- Python
---
<p>This is a demo/tip to show how to call C Shared Lib in python:</p>  <p>Env: <em>gcc version 4.4.5 (Debian 4.4.5-8) </em></p>  <ul>   <li>Edit C function in foo.c</li> </ul>  <div style="font-size: 12px; line-height: 12px; font-family: courier new">   <table style="border-right: 0px; padding-right: 0px; border-top: 0px; padding-left: 0px; padding-bottom: 0px; border-left: 0px; width: 100%; padding-top: 0px; border-bottom: 0px" cellspacing="0"><tbody>       <tr>         <td><b><span style="color: #0000ff">int</span></b><span style="color: #000000"> </span><span style="color: #000000">plus(</span><b><span style="color: #0000ff">int</span></b><span style="color: #000000"> </span><span style="color: #000000">a,</span><b><span style="color: #0000ff">int</span></b><span style="color: #000000"> </span><span style="color: #000000">b)</span></td>       </tr>        <tr>         <td><span style="color: #000000">{</span><span style="color: #000000">    </span></td>       </tr>        <tr>         <td><span style="color: #000000">    </span><b><span style="color: #0000ff">return</span></b><span style="color: #000000"> </span><span style="color: #000000">a</span><span style="color: #ff0000">+</span><span style="color: #000000">b;</span></td>       </tr>        <tr>         <td><span style="color: #000000">}</span></td>       </tr>     </tbody></table> </div>  <ul>   <li>Compile C file into .so lib</li> </ul>  <div style="font-size: 12px; line-height: 12px; font-family: courier new">   <table style="border-right: 0px; padding-right: 0px; border-top: 0px; padding-left: 0px; padding-bottom: 0px; border-left: 0px; width: 100%; padding-top: 0px; border-bottom: 0px" cellspacing="0"><tbody>       <tr>         <td><span style="color: #000000">gcc</span><span style="color: #000000"> </span><span style="color: #000000">-c</span><span style="color: #000000"> </span><span style="color: #000000">-fPIC</span><span style="color: #000000"> </span><span style="color: #000000">-foo.c</span></td>       </tr>        <tr>         <td><span style="color: #000000">gcc</span><span style="color: #000000"> </span><span style="color: #000000">-shared</span><span style="color: #000000"> </span><span style="color: #000000">foo.o</span><span style="color: #000000"> </span><span style="color: #000000">-o</span><span style="color: #000000"> </span><span style="color: #000000">foo.so</span></td>       </tr>     </tbody></table> </div>  <ul>   <li>Edit test.py file</li> </ul>  <div style="font-size: 12px; line-height: 12px; font-family: courier new">   <table style="border-right: 0px; padding-right: 0px; border-top: 0px; padding-left: 0px; padding-bottom: 0px; border-left: 0px; width: 100%; padding-top: 0px; border-bottom: 0px" cellspacing="0"><tbody>       <tr>         <td><span style="color: #008000">#</span><span style="color: #008000">!/bin/env</span><span style="color: #008000"> </span><span style="color: #008000">python</span></td>       </tr>        <tr>         <td><b><span style="color: #0000ff">import</span></b><span style="color: #000000"> </span><b><span style="color: #ff0000">os</span></b></td>       </tr>        <tr>         <td><b><span style="color: #0000ff">from</span></b><span style="color: #000000"> </span><span style="color: #000000">ctypes</span><span style="color: #000000"> </span><b><span style="color: #0000ff">import</span></b><span style="color: #000000"> </span><span style="color: #000000">cdll</span></td>       </tr>        <tr>         <td> </td>       </tr>        <tr>         <td><span style="color: #000000">foo</span><span style="color: #000000"> </span><span style="color: #ff0000">=</span><span style="color: #000000"> </span><span style="color: #000000">cdll</span><span style="color: #ff0000">.</span><span style="color: #000000">LoadLibrary</span><span style="color: #ff0000">(</span><span style="color: #ff0000">'</span><span style="color: #ff0000">.</span><span style="color: #000000">/foo</span><span style="color: #ff0000">.</span><span style="color: #000000">so</span><span style="color: #ff0000">'</span><span style="color: #ff0000">)</span></td>       </tr>        <tr>         <td><b><span style="color: #0000ff">print</span></b><span style="color: #000000"> </span><span style="color: #000000">foo</span><span style="color: #ff0000">.</span><span style="color: #000000">plus</span><span style="color: #ff0000">(</span><b><span style="color: #008080">1</span></b><span style="color: #ff0000">,</span><b><span style="color: #008080">2</span></b><span style="color: #ff0000">)</span></td>       </tr>     </tbody></table> </div>  <ul>   <li>Run .py and get result</li> </ul>  <div style="font-size: 12px; line-height: 12px; font-family: courier new">   <table style="border-right: 0px; padding-right: 0px; border-top: 0px; padding-left: 0px; padding-bottom: 0px; border-left: 0px; width: 100%; padding-top: 0px; border-bottom: 0px" cellspacing="0"><tbody>       <tr>         <td>python test.py</td>       </tr>     </tbody></table> </div>

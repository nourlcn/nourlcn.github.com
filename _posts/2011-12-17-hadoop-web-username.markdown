--- 
title: !binary |
  SGFkb29wIDAuMjPkuK13ZWIgdXNlcm5hbWXnmoTorr7nva4=

type: post
layout: post
tags: 
- Hadoop
- YARN
---
配置好Hadoop0.23的集群，通过浏览器查看集群信息时，有些页面提示我" You (User dr.who) are     not authorized to view the logs ", web页面又上角总是显示 Logged in as: dr.who，这个用户     名应该是默认的，但我不清楚在哪修改。<br /><br />Google了很久，网上已经搜不到相关资料了，只好去看源代码，在StaticUserWebFilter.java里面，有getUsernameFromConf方法：<br /><br /><span style="background-color: #cccccc; color: #274e13;">  /**</span><br /><span style="background-color: #cccccc; color: #274e13;">   * Retrieve the static username from the configuration.</span><br /><span style="background-color: #cccccc; color: #274e13;">   */</span><br /><span style="background-color: #cccccc; color: #274e13;">  static String getUsernameFromConf(Configuration conf) {</span><br /><span style="background-color: #cccccc; color: #274e13;">    String oldStyleUgi = conf.get(DEPRECATED_UGI_KEY);</span><br /><span style="background-color: #cccccc; color: #274e13;">    if (oldStyleUgi != null) {</span><br /><span style="background-color: #cccccc; color: #274e13;">      // We can't use the normal configuration deprecation mechanism here</span><br /><span style="background-color: #cccccc; color: #274e13;">      // since we need to split out the username from the configured UGI.</span><br /><span style="background-color: #cccccc; color: #274e13;">      LOG.warn(DEPRECATED_UGI_KEY + " should not be used. Instead, use " + </span><br /><span style="background-color: #cccccc; color: #274e13;">               USERNAME_KEY + ".");</span><br /><span style="background-color: #cccccc; color: #274e13;">      String[] parts = oldStyleUgi.split(",");</span><br /><span style="background-color: #cccccc; color: #274e13;">      return parts[0];</span><br /><span style="background-color: #cccccc; color: #274e13;">    } else {</span><br /><span style="background-color: #cccccc; color: #274e13;">      return conf.get(USERNAME_KEY, USERNAME_DEFAULT);</span><br /><span style="background-color: #cccccc; color: #274e13;">    }</span><br /><span style="background-color: #cccccc; color: #274e13;">  }</span><br /><br />几个变量定义如下：<br /><span style="background-color: #cccccc; color: #274e13;">  static final String DEPRECATED_UGI_KEY = "dfs.web.ugi";</span><br /><span style="background-color: #cccccc; color: #274e13;">  static final String USERNAME_KEY = "hadoop.http.staticuser.user";</span><br /><span style="background-color: #cccccc; color: #274e13;">  static final String USERNAME_DEFAULT = "dr.who";</span><br /><br />可以看出，hadoop启动时，如果检测到设置了dfs.web.ugi的值，会提示使用新的name:hadoop.http.staticuser.user代替，默认的loggin用户是dr.who<br /><br />解决：<br />在core-site.xml内添加:<br /><span style="background-color: #cccccc; color: #274e13;">    <property></span><br /><span style="background-color: #cccccc; color: #274e13;">        <name>hadoop.http.staticuser.user</name></span><br /><span style="background-color: #cccccc; color: #274e13;">        <value>your_hadoop_user_name</value></span><br /><span style="background-color: #cccccc; color: #274e13;">    </property></span><br /><br />value是你的haoop用户名称，即可.<br /><br />由于0.23config和api不稳定，yarn中使用新的name代替dfs.web.ugi，但在hdfs的配置中，还是需要dfs.web.ugi这个属性，查看关于hdfs的log时，可能还是有用户权限的问题，默认web登录的用户是webuser，在Hadoop代码中：hadoop-hdfs/src/resources/hdfs-default.xml中可以看到，默认的user和group是webuser,webgroup.<br /><br />在hdfs-default.xml中添加以下内容，可解决此问题：<br /><div style="background-color: #cccccc; color: #274e13;"><property></div><div style="background-color: #cccccc; color: #274e13;">  <name>dfs.web.ugi</name></div><div style="background-color: #cccccc; color: #274e13;">  <value>hadoop_user_name,hadoop_user_group</value></div><div style="background-color: #cccccc; color: #274e13;"></property></div>
